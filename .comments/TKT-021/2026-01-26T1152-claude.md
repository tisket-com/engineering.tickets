---
author: Claude
timestamp: 2026-01-26T11:52:35.476Z
---
## Architectural Observations

### PUT Writes via REST API

The client tRPC router (`client/src/trpc/routers/repos.ts`) uses `updateFileContent` which calls GitHub's REST API for writes. However, the MCP server does writes properly via git commit + push.

**Recommendation:** Remove the REST API write path from the client. All writes should go through MCP (git commit + push) for consistency. This would eliminate:
- `PUT /repos/{org}/{repo}/contents/{path}` calls
- The need for `GET` to fetch SHA before PUT

### Database as Source of Truth for Repos

The database already has the schema to be the source of truth:
- `repos` - known repositories
- `workspaceProjects` - projects linked to workspaces
- `workspaceTeams` - teams linked to workspaces

**Current:** `GET /orgs/{org}/repos` is called to discover repos
**Better:** Query database for workspace repos, only call GitHub when:
1. User opens "Add repo" dialog (discovery UI)
2. Manual "Sync with GitHub" action
3. Background sync job (optional, could be hourly/daily)

This would reduce REST API calls from "every page load" to "only when explicitly discovering new repos."

### Summary of Potential REST API Elimination

| Current API Call | Can Eliminate? | How |
|-----------------|----------------|-----|
| `GET /orgs/{org}/repos` | Mostly | DB is source of truth; only for discovery UI |
| `PUT /repos/.../contents/...` | Yes | Route through MCP git push |
| `GET /repos/.../contents/...` | Yes | Use browser git clone |
| `GET /repos/.../commits/...` | Yes | Use browser git clone |

With these changes, the only REST API call needed in normal operation would be `POST /orgs/{org}/repos` (creating new repos).

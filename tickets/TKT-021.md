
status: open
priority: medium
created: 2026-01-26

# TKT-021: Evaluate GitHub App implementation for improved rate limits

## Summary

Investigate migrating from OAuth user tokens to GitHub App installation tokens for improved API rate limits and better multi-tenant scaling.

## Background

Currently Tisket uses OAuth user tokens for GitHub API access. This has rate limit implications:
- REST API: 5,000 requests/hour per user token
- All MCP server operations share the authenticated user's quota

## What GitHub Apps Would Improve

### REST API Rate Limits
- Base: 5,000 requests/hour per installation
- Scales: +50 req/hour per repo (max 12,500)
- Scales: +50 req/hour per org user (max 12,500)
- Each org installation gets its own rate limit pool
- GitHub Enterprise Cloud: 15,000 requests/hour

### Multi-tenant Benefits
- Rate limits isolated per organization
- One org's heavy usage doesn't affect others
- Better scaling as user base grows

## What GitHub Apps Would NOT Change

### Git Protocol Operations
- `clone`, `fetch`, `push`, `listServerRefs` limits unchanged
- These are per-repository (~15 ops/second/repo), compute-based
- Not tied to authentication method
- Already generous for Tisket's use case (small repos, incremental fetches)

## Implementation Considerations

### Required Changes
1. Create and register a GitHub App
2. Implement app installation flow (user installs app on their org)
3. Manage installation access tokens (short-lived, need refresh)
4. Update MCP server to authenticate as installation, not user
5. Handle multiple installations (one per org)

### Trade-offs
| Aspect | OAuth (Current) | GitHub App |
|--------|-----------------|------------|
| Setup complexity | Simple | More complex |
| User experience | Single OAuth flow | Must install app on org |
| Rate limits | Per-user, fixed | Per-installation, scales |
| Token management | Long-lived | Short-lived, needs refresh |
| Permissions | User's full access | Scoped to app permissions |

### Security Benefits
- Scoped permissions (only what app needs)
- Tokens are installation-scoped, not user-scoped
- Better audit trail (actions attributed to app)

## Questions to Resolve
- Do we need both OAuth (for user identity) AND GitHub App (for repo access)?
- How to handle the installation flow in the UI?
- Token refresh strategy for MCP server?

## References
- https://docs.github.com/en/apps/creating-github-apps/registering-a-github-app/rate-limits-for-github-apps
- https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/rate-limits-for-oauth-apps
- https://docs.github.com/en/repositories/creating-and-managing-repositories/repository-limits

---

**Claude** · *2026-01-26*

> ## Current REST API Usage
> 
> ### Client (`client/src/lib/github.ts`)
> 
> | Function | Endpoint | Purpose |
> |-|-||
> | `listRepos` | `GET /orgs/{org}/repos` | Repo discovery |
> | `createGitHubRepo` | `POST /orgs/{org}/repos` | Create new repo |
> | `createGitHubRepo` | `PUT /repos/{org}/{repo}/contents/README.md` | Initial README |
> | `getRepoContents` | `GET /repos/{org}/{repo}/contents/{path}` | List directory |
> | `getFileContent` | `GET /repos/{org}/{repo}/contents/{path}` | Read file |
> | `getHeadSha` | `GET /repos/{org}/{repo}/commits/main` | Get latest commit |
> | `getRepoCommits` | `GET /repos/{org}/{repo}/commits` | List commits |
> | `getCommitDetail` | `GET /repos/{org}/{repo}/commits/{sha}` | Commit metadata |
> | `getFileContentAtCommit` | `GET /repos/{org}/{repo}/contents/{path}?ref={ref}` | File at commit |
> | `getGitCommitObject` | `GET /repos/{org}/{repo}/git/commits/{sha}` | Git commit object |
> | `getFileCommitHistory` | `GET /repos/{org}/{repo}/commits?path={path}` | File history |
> | `getFileTree` | `GET /repos/{org}/{repo}/contents/{path}` | Recursive tree |
> | `updateFileContent` | `PUT /repos/{org}/{repo}/contents/{path}` | Write file |
> 
> ### MCP Server (`mcp/src/lib/github.ts`, `mcp/src/operations/repos.ts`)
> 
> | Function | Endpoint | Purpose |
> |-|-||
> | `listRepos` | `GET /orgs/{org}/repos` | Repo discovery |
> | `listAvailableRepos` | `GET /orgs/{org}/repos` | Available repos |
> | `getRepoContents` | `GET /repos/{org}/{repo}/contents/{path}` | List directory |
> | `getFileContent` | `GET /repos/{org}/{repo}/contents/{path}` | Read file |
> | `getHeadSha` | `GET /repos/{org}/{repo}/commits/main` | Get latest commit |
> | `getRepoCommits` | `GET /repos/{org}/{repo}/commits` | List commits |
> | `getFileTree` | `GET /repos/{org}/{repo}/contents/{path}` | Recursive tree |
> | `createGitHubRepo` | `POST /orgs/{org}/repos` | Create new repo |
> | `createGitHubRepo` | `PUT /repos/{org}/{repo}/contents/README.md` | Initial README |
> 
> ### Note on Current Architecture
> 
> Many of these client-side REST API calls should already be avoided per CLAUDE.md guidelines - the browser git clone is supposed to be the source of truth for reads. The REST API calls that remain necessary are:
> 
> **Must use REST API:**
> - `GET /orgs/{org}/repos` - Repo discovery (not in git)
> - `POST /orgs/{org}/repos` - Create repo
> - `PUT /repos/.../contents/...` - Write operations (when not using git push)
> 
> **Should use local browser git instead:**
> - All `GET /repos/.../contents/...` calls
> - All `GET /repos/.../commits/...` calls
> - File tree, file history, commit details
> 
> If the architecture is properly followed, REST API usage should be minimal.


**Claude** · *2026-01-26*

> ## Architectural Observations
> 
> ### PUT Writes via REST API
> 
> The client tRPC router (`client/src/trpc/routers/repos.ts`) uses `updateFileContent` which calls GitHub's REST API for writes. However, the MCP server does writes properly via git commit + push.
> 
> **Recommendation:** Remove the REST API write path from the client. All writes should go through MCP (git commit + push) for consistency. This would eliminate:
> - `PUT /repos/{org}/{repo}/contents/{path}` calls
> - The need for `GET` to fetch SHA before PUT
> 
> ### Database as Source of Truth for Repos
> 
> The database already has the schema to be the source of truth:
> - `repos` - known repositories
> - `workspaceProjects` - projects linked to workspaces
> - `workspaceTeams` - teams linked to workspaces
> 
> **Current:** `GET /orgs/{org}/repos` is called to discover repos
> **Better:** Query database for workspace repos, only call GitHub when:
> 1. User opens "Add repo" dialog (discovery UI)
> 2. Manual "Sync with GitHub" action
> 3. Background sync job (optional, could be hourly/daily)
> 
> This would reduce REST API calls from "every page load" to "only when explicitly discovering new repos."
> 
> ### Summary of Potential REST API Elimination
> 
> | Current API Call | Can Eliminate? | How |
> |--|-|--|
> | `GET /orgs/{org}/repos` | Mostly | DB is source of truth; only for discovery UI |
> | `PUT /repos/.../contents/...` | Yes | Route through MCP git push |
> | `GET /repos/.../contents/...` | Yes | Use browser git clone |
> | `GET /repos/.../commits/...` | Yes | Use browser git clone |
> 
> With these changes, the only REST API call needed in normal operation would be `POST /orgs/{org}/repos` (creating new repos).
